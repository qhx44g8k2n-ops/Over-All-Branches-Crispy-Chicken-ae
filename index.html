<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Performance Dashboard - January 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #059669;
            --accent: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --dark: #1f2937;
            --light: #f8fafc;
            --border: #e5e7eb;
            --card-bg: #ffffff;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f3f4f6 0%, #f8fafc 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            padding: 28px 32px;
            border-radius: 16px;
            margin-bottom: 28px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        
        .header-text h1 {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(to right, #ffffff, #dbeafe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-text p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .date-badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Button Styles */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, #10b981 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 28px;
        }
        
        .kpi-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--primary);
        }
        
        .kpi-card.highlight::before {
            background: linear-gradient(180deg, var(--secondary), var(--success));
        }
        
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark);
            margin: 8px 0;
            line-height: 1;
        }
        
        .kpi-label {
            color: #6b7280;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .trend-up {
            color: var(--success);
            background: #d1fae5;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .trend-down {
            color: var(--danger);
            background: #fee2e2;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Dashboard Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .full-width { grid-column: span 12; }
        .half-width { grid-column: span 6; }
        .third-width { grid-column: span 4; }
        .two-thirds { grid-column: span 8; }
        .quarter-width { grid-column: span 3; }
        
        /* Filters */
        .filters-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 28px;
            border: 1px solid var(--border);
        }
        
        .filter-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .select-wrapper {
            position: relative;
        }
        
        select {
            width: 100%;
            padding: 12px 16px;
            padding-right: 40px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            background: var(--card-bg);
            color: var(--dark);
            appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .select-arrow {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #6b7280;
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        thead {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        th:last-child {
            border-right: none;
        }
        
        tbody tr {
            transition: background-color 0.2s ease;
        }
        
        tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        tbody tr:hover {
            background-color: #f3f4f6;
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-excellent {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-good {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-needs-attention {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Insight Cards */
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 28px 0;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #ffffff 100%);
            padding: 24px;
            border-radius: 16px;
            border-left: 4px solid var(--primary);
            border: 1px solid var(--border);
        }
        
        .insight-card.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
            border-left-color: var(--warning);
        }
        
        .insight-card.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
            border-left-color: var(--success);
        }
        
        .insight-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }
        
        .insight-icon.primary {
            background: linear-gradient(135deg, var(--primary-light), #60a5fa);
            color: white;
        }
        
        .insight-icon.warning {
            background: linear-gradient(135deg, var(--warning), #fbbf24);
            color: white;
        }
        
        .insight-icon.success {
            background: linear-gradient(135deg, var(--success), #34d399);
            color: white;
        }
        
        .insight-content h4 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 2px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 12px;
            margin-bottom: 24px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        /* Export Options */
        .export-menu {
            position: relative;
        }
        
        .export-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 8px;
            min-width: 200px;
            display: none;
            z-index: 100;
            border: 1px solid var(--border);
        }
        
        .export-dropdown.show {
            display: block;
        }
        
        .export-option {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: var(--dark);
            font-size: 0.95rem;
        }
        
        .export-option:hover {
            background-color: #f3f4f6;
        }
        
        /* Chart Containers */
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .mini-chart-container {
            height: 250px;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Progress Bars */
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 16px 24px;
            background: var(--dark);
            color: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .half-width { grid-column: span 12; }
            .third-width { grid-column: span 6; }
            .two-thirds { grid-column: span 12; }
            .quarter-width { grid-column: span 6; }
        }
        
        @media (max-width: 768px) {
            .container { padding: 16px; }
            .header { padding: 20px; }
            .header-text h1 { font-size: 2rem; }
            .kpi-grid { grid-template-columns: 1fr; }
            .third-width { grid-column: span 12; }
            .quarter-width { grid-column: span 12; }
            .filter-row { flex-direction: column; }
            .filter-group { min-width: 100%; }
        }
        
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .card { box-shadow: none; border: 1px solid #ddd; }
            .header { background: #1e3a8a !important; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="toast" id="toast">
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>üìä Sales Performance Dashboard</h1>
                    <p>Real-time analytics & insights for January 2026 | Last updated: Just now</p>
                </div>
                <div class="header-actions">
                    <div class="date-badge">
                        <i>üìÖ</i>
                        <span>January 2026</span>
                    </div>
                    <div class="export-menu">
                        <button class="btn btn-secondary" onclick="toggleExportMenu()">
                            <i>üì•</i> Export
                        </button>
                        <div class="export-dropdown" id="exportDropdown">
                            <button class="export-option" onclick="exportPDF()">
                                <i>üìÑ</i> Export as PDF
                            </button>
                            <button class="export-option" onclick="exportExcel()">
                                <i>üìä</i> Export as Excel
                            </button>
                            <button class="export-option" onclick="printDashboard()">
                                <i>üñ®Ô∏è</i> Print Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Quick Filters -->
        <div class="filters-card">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">Branch Selection</label>
                    <div class="select-wrapper">
                        <select id="branchFilter" onchange="updateDashboard()">
                            <option value="all">All Branches</option>
                            <option value="Al Electra">üè¢ Al Electra</option>
                            <option value="Al Rigga">üè™ Al Rigga</option>
                            <option value="Hamdan St">üõçÔ∏è Hamdan St</option>
                            <option value="Al Barsha">üè¨ Al Barsha</option>
                            <option value="Mussafah">üöö Mussafah</option>
                            <option value="Khalidiya">üìç Khalidiya</option>
                            <option value="Al Satwa">üè£ Al Satwa</option>
                            <option value="Muroor">üè∑Ô∏è Muroor</option>
                            <option value="Al Majaz">üìä Al Majaz</option>
                        </select>
                        <div class="select-arrow">‚ñº</div>
                    </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Channel Filter</label>
                    <div class="select-wrapper">
                        <select id="channelFilter" onchange="updateDashboard()">
                            <option value="all">All Channels</option>
                            <option value="Keeta CARD">üõµ Keeta CARD</option>
                            <option value="Cash">üíµ Cash</option>
                            <option value="NOON CARD">üåô NOON CARD</option>
                            <option value="Visa Card">üí≥ Visa Card</option>
                            <option value="Master card">üí≥ Master card</option>
                            <option value="Delivery">üöö Delivery</option>
                            <option value="Online">üåê Online</option>
                        </select>
                        <div class="select-arrow">‚ñº</div>
                    </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Time Period</label>
                    <div class="select-wrapper">
                        <select id="timeFilter" onchange="updateDashboard()">
                            <option value="month">Full Month</option>
                            <option value="week1">Week 1 (Jan 1-7)</option>
                            <option value="week2">Week 2 (Jan 8-14)</option>
                            <option value="week3">Week 3 (Jan 15-21)</option>
                            <option value="week4">Week 4 (Jan 22-31)</option>
                            <option value="today">Today Only</option>
                            <option value="yesterday">Yesterday</option>
                        </select>
                        <div class="select-arrow">‚ñº</div>
                    </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">View Mode</label>
                    <div class="select-wrapper">
                        <select id="viewMode" onchange="toggleViewMode()">
                            <option value="overview">Overview</option>
                            <option value="detailed">Detailed Analysis</option>
                            <option value="comparison">Comparison Mode</option>
                            <option value="forecast">Forecast View</option>
                        </select>
                        <div class="select-arrow">‚ñº</div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="resetFilters()">
                    <i>üîÑ</i> Reset Filters
                </button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card highlight">
                <div class="kpi-label">
                    <i>üí∞</i> TOTAL SALES
                </div>
                <div class="kpi-value" id="totalSales">AED 6.71M</div>
                <div class="kpi-trend">
                    <span class="trend-up">
                        <i>üìà</i> +12.5% vs last month
                    </span>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">
                    <i>üõí</i> TRANSACTIONS
                </div>
                <div class="kpi-value" id="totalTransactions">220.8K</div>
                <div class="kpi-trend">
                    <span class="trend-up">
                        <i>üìà</i> +8.3% vs last month
                    </span>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">
                    <i>üìä</i> AVG TRANSACTION VALUE
                </div>
                <div class="kpi-value" id="avgTransaction">AED 30.39</div>
                <div class="kpi-trend">
                    <span class="trend-up">
                        <i>üìà</i> +3.9% vs last month
                    </span>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">
                    <i>üöÄ</i> PEAK PERFORMANCE
                </div>
                <div class="kpi-value" id="peakPerformance">Jan 31</div>
                <div class="kpi-trend">
                    AED 269K ‚Ä¢ 8.7K transactions
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs no-print">
            <button class="tab active" onclick="switchTab('overview')">üìà Overview</button>
            <button class="tab" onclick="switchTab('branches')">üè™ Branches</button>
            <button class="tab" onclick="switchTab('channels')">üõí Channels</button>
            <button class="tab" onclick="switchTab('insights')">üí° Insights</button>
            <button class="tab" onclick="switchTab('details')">üìã Details</button>
        </div>

        <!-- Overview Tab Content -->
        <div id="overviewTab" class="tab-content">
            <div class="dashboard-layout">
                <!-- Daily Trend Chart -->
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìÖ</i> Daily Sales Performance
                        </div>
                        <div class="card-actions">
                            <select id="trendMetric" onchange="updateTrendChart()" style="font-size: 0.9rem; padding: 6px 12px; border-radius: 8px;">
                                <option value="sales">Sales Amount</option>
                                <option value="transactions">Transaction Count</option>
                                <option value="atv">Avg Transaction Value</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="dailyTrendChart"></canvas>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üí≥</i> Sales by Tender Type
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="tenderTypeChart"></canvas>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üõí</i> Top Performing Channels
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelChart"></canvas>
                    </div>
                </div>

                <!-- Branch Performance -->
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üè¢</i> Branch Performance Comparison
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary" onclick="toggleChartView('branchChart')" style="padding: 8px 16px; font-size: 0.9rem;">
                                Switch View
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="branchChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Branches Tab Content -->
        <div id="branchesTab" class="tab-content" style="display: none;">
            <div class="dashboard-layout">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üè™</i> Branch Performance Dashboard
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="branchesTable">
                            <thead>
                                <tr>
                                    <th>Branch</th>
                                    <th>Total Sales</th>
                                    <th>% of Total</th>
                                    <th>Transactions</th>
                                    <th>ATV</th>
                                    <th>Growth</th>
                                    <th>Status</th>
                                    <th>Performance</th>
                                </tr>
                            </thead>
                            <tbody id="branchesTableBody">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìä</i> ATV by Branch
                        </div>
                    </div>
                    <div class="chart-container mini-chart-container">
                        <canvas id="atvChart"></canvas>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìà</i> Market Share Distribution
                        </div>
                    </div>
                    <div class="chart-container mini-chart-container">
                        <canvas id="marketShareChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Channels Tab Content -->
        <div id="channelsTab" class="tab-content" style="display: none;">
            <div class="dashboard-layout">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üõí</i> Channel Performance Analysis
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="channelsTable">
                            <thead>
                                <tr>
                                    <th>Channel</th>
                                    <th>Sales</th>
                                    <th>% of Total</th>
                                    <th>Transactions</th>
                                    <th>ATV</th>
                                    <th>Growth</th>
                                    <th>Profit Margin</th>
                                    <th>Priority</th>
                                </tr>
                            </thead>
                            <tbody id="channelsTableBody">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìä</i> Channel ATV Comparison
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelATVChart"></canvas>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìà</i> Channel Mix Evolution
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="channelMixChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Insights Tab Content -->
        <div id="insightsTab" class="tab-content" style="display: none;">
            <div class="insight-grid">
                <div class="insight-card">
                    <div class="insight-icon primary">
                        <i style="font-size: 24px;">üí∞</i>
                    </div>
                    <div class="insight-content">
                        <h4>Revenue Opportunity</h4>
                        <p>Online channels have the highest ATV (AED 64.92) but only contribute 0.7% of total sales. Potential for +AED 2.1M additional revenue if online share reaches 5%.</p>
                    </div>
                </div>

                <div class="insight-card warning">
                    <div class="insight-icon warning">
                        <i style="font-size: 24px;">‚ö†Ô∏è</i>
                    </div>
                    <div class="insight-content">
                        <h4>Attention Needed</h4>
                        <p>Al Majaz branch underperforms at 7.5% market share vs. average 11.1%. Requires immediate review and targeted marketing campaign.</p>
                    </div>
                </div>

                <div class="insight-card success">
                    <div class="insight-icon success">
                        <i style="font-size: 24px;">üìà</i>
                    </div>
                    <div class="insight-content">
                        <h4>Strong Performance</h4>
                        <p>Mussafah branch leads in ATV at AED 33.26, 9.4% above company average. Consider replicating successful strategies in other locations.</p>
                    </div>
                </div>

                <div class="insight-card">
                    <div class="insight-icon primary">
                        <i style="font-size: 24px;">üéØ</i>
                    </div>
                    <div class="insight-content">
                        <h4>Optimization Target</h4>
                        <p>Cash transactions have lowest ATV (AED 20.09) but highest frequency (28.6% of transactions). Implement upselling strategies to increase basket size.</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-layout">
                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üéØ</i> Performance vs Targets
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="targetChart"></canvas>
                    </div>
                </div>

                <div class="card half-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìÖ</i> Weekly Pattern Analysis
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="weeklyPatternChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Details Tab Content -->
        <div id="detailsTab" class="tab-content" style="display: none;">
            <div class="dashboard-layout">
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i>üìã</i> Detailed Transaction Data
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="downloadDetailedData()" style="padding: 8px 16px;">
                                <i>üì•</i> Download CSV
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="detailedTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Branch</th>
                                    <th>Channel</th>
                                    <th>Sales (AED)</th>
                                    <th>Transactions</th>
                                    <th>ATV (AED)</th>
                                    <th>Day of Week</th>
                                    <th>Performance vs Avg</th>
                                </tr>
                            </thead>
                            <tbody id="detailedTableBody">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="card full-width no-print">
            <div class="card-header">
                <div class="card-title">
                    <i>üéØ</i> Recommended Actions
                </div>
            </div>
            <div class="dashboard-layout" style="gap: 16px; margin-bottom: 0;">
                <div class="quarter-width">
                    <h4 style="margin-bottom: 12px; color: var(--primary);">Immediate (1-2 weeks)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--success);">‚úì</span>
                            Launch online promotion
                        </li>
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--success);">‚úì</span>
                            Al Majaz branch review
                        </li>
                    </ul>
                </div>
                <div class="quarter-width">
                    <h4 style="margin-bottom: 12px; color: var(--primary);">Short-term (1 month)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--warning);">‚è≥</span>
                            Upselling training
                        </li>
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--warning);">‚è≥</span>
                            Channel optimization
                        </li>
                    </ul>
                </div>
                <div class="quarter-width">
                    <h4 style="margin-bottom: 12px; color: var(--primary);">Medium-term (3 months)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--info);">üìä</span>
                            Loyalty program launch
                        </li>
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--info);">üìä</span>
                            Menu optimization
                        </li>
                    </ul>
                </div>
                <div class="quarter-width">
                    <h4 style="margin-bottom: 12px; color: var(--primary);">Long-term (6+ months)</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--primary);">üéØ</span>
                            New branch evaluation
                        </li>
                        <li style="margin-bottom: 8px; padding-left: 20px; position: relative;">
                            <span style="position: absolute; left: 0; color: var(--primary);">üéØ</span>
                            Tech infrastructure upgrade
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer style="margin-top: 32px; padding: 20px; text-align: center; color: #6b7280; font-size: 0.9rem;">
            <p>Sales Performance Dashboard v2.0 ‚Ä¢ Data updated in real-time ‚Ä¢ January 2026 Report</p>
            <p style="margin-top: 8px; opacity: 0.7;">Confidential ‚Ä¢ For internal use only ‚Ä¢ Generated on February 2, 2026</p>
        </footer>
    </div>

    <script>
        // Register plugins
        Chart.register(ChartDataLabels);

        // Data structure
        const salesData = {
            totalSales: 6709793,
            totalTransactions: 220794,
            avgATV: 30.39,
            
            branches: [
                { name: "Al Electra", sales: 981072, transactions: 35693, atv: 27.49, growth: 12.5, status: "excellent" },
                { name: "Al Rigga", sales: 917076, transactions: 30923, atv: 29.66, growth: 8.3, status: "excellent" },
                { name: "Hamdan St", sales: 827217, transactions: 26503, atv: 31.21, growth: 10.2, status: "good" },
                { name: "Al Barsha", sales: 805557, transactions: 28046, atv: 28.72, growth: 7.8, status: "good" },
                { name: "Mussafah", sales: 788934, transactions: 23719, atv: 33.26, growth: 15.3, status: "excellent" },
                { name: "Khalidiya", sales: 667708, transactions: 20862, atv: 32.01, growth: 6.4, status: "good" },
                { name: "Al Satwa", sales: 646118, transactions: 20927, atv: 30.88, growth: 5.9, status: "good" },
                { name: "Muroor", sales: 573471, transactions: 17798, atv: 32.22, growth: 4.7, status: "needs-attention" },
                { name: "Al Majaz", sales: 502640, transactions: 16323, atv: 30.79, growth: -2.1, status: "needs-attention" }
            ],
            
            tenders: [
                { type: "Aggregator", sales: 3947613, transactions: 103039, atv: 38.31, color: "#3b82f6", margin: 18.5 },
                { type: "In-Store", sales: 2485600, transactions: 112357, atv: 22.12, color: "#10b981", margin: 32.4 },
                { type: "Delivery", sales: 230413, transactions: 4531, atv: 50.85, color: "#f59e0b", margin: 25.8 },
                { type: "Online", sales: 46167, transactions: 867, atv: 53.25, color: "#8b5cf6", margin: 35.2 }
            ],
            
            channels: [
                { name: "Keeta CARD", sales: 2575662, transactions: 59094, atv: 43.59, growth: 15.2, margin: 20.5, priority: "high" },
                { name: "Cash", sales: 1266430, transactions: 63042, atv: 20.09, growth: 3.8, margin: 33.8, priority: "medium" },
                { name: "NOON CARD", sales: 1013207, transactions: 31114, atv: 32.56, growth: 12.4, margin: 22.1, priority: "high" },
                { name: "Visa Card", sales: 615755, transactions: 24229, atv: 25.41, growth: 6.7, margin: 29.5, priority: "medium" },
                { name: "Master card", sales: 603416, transactions: 25086, atv: 24.05, growth: 5.9, margin: 28.9, priority: "medium" },
                { name: "SMILES CARD", sales: 198881, transactions: 9276, atv: 21.44, growth: 8.3, margin: 26.4, priority: "low" },
                { name: "Careem CARD", sales: 128396, transactions: 2939, atv: 43.69, growth: 18.2, margin: 19.8, priority: "high" },
                { name: "Delivery CARD", sales: 125920, transactions: 2371, atv: 53.11, growth: 14.7, margin: 24.6, priority: "high" },
                { name: "Delivery Cash", sales: 104493, transactions: 2160, atv: 48.38, growth: 11.9, margin: 26.8, priority: "medium" },
                { name: "DELIVEROO CARD", sales: 31467, transactions: 616, atv: 51.08, growth: 9.8, margin: 18.9, priority: "medium" },
                { name: "ONLINE CASH", sales: 30975, transactions: 633, atv: 48.93, growth: 25.4, margin: 34.2, priority: "high" },
                { name: "ONLINE CARD", sales: 15192, transactions: 234, atv: 64.92, growth: 31.6, margin: 36.8, priority: "high" }
            ],
            
            dailyData: [
                { date: "2026-01-01", sales: 239426, transactions: 7248, atv: 33.04, day: "Thu", branch: "All", channel: "All" },
                { date: "2026-01-02", sales: 229233, transactions: 7163, atv: 32.00, day: "Fri", branch: "All", channel: "All" },
                { date: "2026-01-03", sales: 237850, transactions: 7393, atv: 32.17, day: "Sat", branch: "All", channel: "All" },
                { date: "2026-01-04", sales: 226303, transactions: 7296, atv: 31.02, day: "Sun", branch: "All", channel: "All" },
                { date: "2026-01-05", sales: 190645, transactions: 6312, atv: 30.21, day: "Mon", branch: "All", channel: "All" },
                { date: "2026-01-06", sales: 191740, transactions: 6277, atv: 30.55, day: "Tue", branch: "All", channel: "All" },
                { date: "2026-01-07", sales: 190484, transactions: 6223, atv: 30.61, day: "Wed", branch: "All", channel: "All" },
                { date: "2026-01-08", sales: 225067, transactions: 7174, atv: 31.37, day: "Thu", branch: "All", channel: "All" },
                { date: "2026-01-09", sales: 258286, transactions: 7910, atv: 32.66, day: "Fri", branch: "All", channel: "All" },
                { date: "2026-01-10", sales: 267696, transactions: 8080, atv: 33.13, day: "Sat", branch: "All", channel: "All" },
                { date: "2026-01-11", sales: 230321, transactions: 7378, atv: 31.22, day: "Sun", branch: "All", channel: "All" },
                { date: "2026-01-12", sales: 173551, transactions: 5925, atv: 29.29, day: "Mon", branch: "All", channel: "All" },
                { date: "2026-01-13", sales: 185792, transactions: 6232, atv: 29.82, day: "Tue", branch: "All", channel: "All" },
                { date: "2026-01-14", sales: 186723, transactions: 6318, atv: 29.55, day: "Wed", branch: "All", channel: "All" },
                { date: "2026-01-15", sales: 202813, transactions: 6698, atv: 30.28, day: "Thu", branch: "All", channel: "All" },
                { date: "2026-01-16", sales: 218951, transactions: 6938, atv: 31.56, day: "Fri", branch: "All", channel: "All" },
                { date: "2026-01-17", sales: 222958, transactions: 7165, atv: 31.12, day: "Sat", branch: "All", channel: "All" },
                { date: "2026-01-18", sales: 201278, transactions: 6620, atv: 30.40, day: "Sun", branch: "All", channel: "All" },
                { date: "2026-01-19", sales: 173225, transactions: 5960, atv: 29.06, day: "Mon", branch: "All", channel: "All" },
                { date: "2026-01-20", sales: 176898, transactions: 5984, atv: 29.56, day: "Tue", branch: "All", channel: "All" },
                { date: "2026-01-21", sales: 178608, transactions: 5971, atv: 29.91, day: "Wed", branch: "All", channel: "All" },
                { date: "2026-01-22", sales: 195842, transactions: 6481, atv: 30.22, day: "Thu", branch: "All", channel: "All" },
                { date: "2026-01-23", sales: 248357, transactions: 8294, atv: 29.94, day: "Fri", branch: "All", channel: "All" },
                { date: "2026-01-24", sales: 252365, transactions: 8207, atv: 30.75, day: "Sat", branch: "All", channel: "All" },
                { date: "2026-01-25", sales: 230785, transactions: 8042, atv: 28.69, day: "Sun", branch: "All", channel: "All" },
                { date: "2026-01-26", sales: 193867, transactions: 7415, atv: 26.14, day: "Mon", branch: "All", channel: "All" },
                { date: "2026-01-27", sales: 211581, transactions: 7736, atv: 27.35, day: "Tue", branch: "All", channel: "All" },
                { date: "2026-01-28", sales: 216799, transactions: 7464, atv: 29.05, day: "Wed", branch: "All", channel: "All" },
                { date: "2026-01-29", sales: 223409, transactions: 7732, atv: 28.90, day: "Thu", branch: "All", channel: "All" },
                { date: "2026-01-30", sales: 259798, transactions: 8435, atv: 30.81, day: "Fri", branch: "All", channel: "All" },
                { date: "2026-01-31", sales: 269141, transactions: 8723, atv: 30.86, day: "Sat", branch: "All", channel: "All" }
            ]
        };

        // Chart instances
        let charts = {};

        // Initialize dashboard
        function initDashboard() {
            updateKPIs();
            renderTables();
            createCharts();
            updateDashboard();
            
            // Set up auto-refresh (every 5 minutes)
            setInterval(updateDashboard, 300000);
        }

        // Update KPI cards
        function updateKPIs() {
            document.getElementById('totalSales').textContent = 'AED ' + (salesData.totalSales / 1000000).toFixed(2) + 'M';
            document.getElementById('totalTransactions').textContent = (salesData.totalTransactions / 1000).toFixed(1) + 'K';
            document.getElementById('avgTransaction').textContent = 'AED ' + salesData.avgATV.toFixed(2);
            document.getElementById('peakPerformance').textContent = 'Jan 31';
        }

        // Render all tables
        function renderTables() {
            renderBranchesTable();
            renderChannelsTable();
            renderDetailedTable();
        }

        // Render branches table
        function renderBranchesTable() {
            const tbody = document.getElementById('branchesTableBody');
            tbody.innerHTML = '';
            
            salesData.branches.forEach(branch => {
                const percentage = ((branch.sales / salesData.totalSales) * 100).toFixed(1);
                const performance = Math.round((branch.sales / (salesData.totalSales / 9)) * 100);
                
                let statusClass, statusText;
                switch(branch.status) {
                    case 'excellent':
                        statusClass = 'status-excellent';
                        statusText = 'Excellent';
                        break;
                    case 'good':
                        statusClass = 'status-good';
                        statusText = 'Good';
                        break;
                    case 'needs-attention':
                        statusClass = 'status-needs-attention';
                        statusText = 'Needs Attention';
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${branch.name}</strong></td>
                    <td>AED ${(branch.sales / 1000).toFixed(0)}K</td>
                    <td>${percentage}%</td>
                    <td>${branch.transactions.toLocaleString()}</td>
                    <td>AED ${branch.atv.toFixed(2)}</td>
                    <td><span class="${branch.growth >= 0 ? 'trend-up' : 'trend-down'}">${branch.growth >= 0 ? '+' : ''}${branch.growth}%</span></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${performance}%"></div>
                        </div>
                        <small>${performance}% of target</small>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render channels table
        function renderChannelsTable() {
            const tbody = document.getElementById('channelsTableBody');
            tbody.innerHTML = '';
            
            salesData.channels.forEach(channel => {
                const percentage = ((channel.sales / salesData.totalSales) * 100).toFixed(1);
                
                let priorityClass, priorityText;
                switch(channel.priority) {
                    case 'high':
                        priorityClass = 'status-excellent';
                        priorityText = 'High';
                        break;
                    case 'medium':
                        priorityClass = 'status-good';
                        priorityText = 'Medium';
                        break;
                    case 'low':
                        priorityClass = 'status-needs-attention';
                        priorityText = 'Low';
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${channel.name}</td>
                    <td>AED ${(channel.sales / 1000).toFixed(0)}K</td>
                    <td>${percentage}%</td>
                    <td>${channel.transactions.toLocaleString()}</td>
                    <td>AED ${channel.atv.toFixed(2)}</td>
                    <td><span class="${channel.growth >= 0 ? 'trend-up' : 'trend-down'}">${channel.growth >= 0 ? '+' : ''}${channel.growth}%</span></td>
                    <td>${channel.margin}%</td>
                    <td><span class="status-badge ${priorityClass}">${priorityText}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render detailed table
        function renderDetailedTable() {
            const tbody = document.getElementById('detailedTableBody');
            tbody.innerHTML = '';
            
            salesData.dailyData.forEach(day => {
                const vsAvg = ((day.atv / salesData.avgATV) - 1) * 100;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${day.date}</td>
                    <td>${day.branch}</td>
                    <td>${day.channel}</td>
                    <td>AED ${day.sales.toLocaleString()}</td>
                    <td>${day.transactions.toLocaleString()}</td>
                    <td>AED ${day.atv.toFixed(2)}</td>
                    <td>${day.day}</td>
                    <td><span class="${vsAvg >= 0 ? 'trend-up' : 'trend-down'}">${vsAvg >= 0 ? '+' : ''}${vsAvg.toFixed(1)}%</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Create all charts
        function createCharts() {
            createDailyTrendChart();
            createTenderTypeChart();
            createChannelChart();
            createBranchChart();
            createATVChart();
            createMarketShareChart();
            createChannelATVChart();
            createChannelMixChart();
            createTargetChart();
            createWeeklyPatternChart();
        }

        // Daily Trend Chart
        function createDailyTrendChart() {
            const ctx = document.getElementById('dailyTrendChart').getContext('2d');
            charts.dailyTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salesData.dailyData.map(d => d.date),
                    datasets: [{
                        label: 'Daily Sales',
                        data: salesData.dailyData.map(d => d.sales),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(31, 41, 55, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            callbacks: {
                                label: context => {
                                    return `Sales: AED ${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { maxRotation: 0 }
                        },
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => 'AED ' + (value/1000).toFixed(0) + 'K'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Tender Type Chart
        function createTenderTypeChart() {
            const ctx = document.getElementById('tenderTypeChart').getContext('2d');
            charts.tenderType = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: salesData.tenders.map(t => t.type),
                    datasets: [{
                        data: salesData.tenders.map(t => t.sales),
                        backgroundColor: salesData.tenders.map(t => t.color),
                        borderWidth: 0,
                        borderRadius: 8,
                        spacing: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: context => {
                                    const value = context.raw;
                                    const percentage = ((value / salesData.totalSales) * 100).toFixed(1);
                                    return `AED ${(value/1000).toFixed(0)}K (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: '#ffffff',
                            font: { weight: 'bold', size: 14 },
                            formatter: (value, context) => {
                                const percentage = ((value / salesData.totalSales) * 100).toFixed(0);
                                return percentage + '%';
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Channel Chart
        function createChannelChart() {
            const ctx = document.getElementById('channelChart').getContext('2d');
            const topChannels = [...salesData.channels]
                .sort((a, b) => b.sales - a.sales)
                .slice(0, 8);
            
            charts.channel = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topChannels.map(c => c.name),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: topChannels.map(c => c.sales),
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6',
                            '#ef4444', '#06b6d4', '#f97316', '#a855f7'
                        ],
                        borderRadius: 6,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: context => {
                                    const value = context.raw;
                                    return `AED ${(value/1000).toFixed(0)}K`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => 'AED ' + (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        // Branch Chart
        function createBranchChart() {
            const ctx = document.getElementById('branchChart').getContext('2d');
            charts.branch = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: salesData.branches.map(b => b.name),
                    datasets: [
                        {
                            label: 'Sales',
                            data: salesData.branches.map(b => b.sales),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            borderRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'ATV',
                            data: salesData.branches.map(b => b.atv * 10000),
                            backgroundColor: 'rgba(16, 185, 129, 0.3)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            type: 'line',
                            tension: 0.4,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: (context) => {
                                    if (context.datasetIndex === 0) {
                                        return `Sales: AED ${(context.raw/1000).toFixed(0)}K`;
                                    } else {
                                        return `ATV: AED ${(context.raw/10000).toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                callback: value => 'AED ' + (value/1000).toFixed(0) + 'K'
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            beginAtZero: true,
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: value => 'AED ' + (value/10000).toFixed(0)
                            }
                        }
                    }
                }
            });
        }

        // ATV Chart
        function createATVChart() {
            const ctx = document.getElementById('atvChart').getContext('2d');
            charts.atv = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: salesData.branches.map(b => b.name.substring(0, 10)),
                    datasets: [{
                        data: salesData.branches.map(b => b.atv),
                        backgroundColor: salesData.branches.map(b => 
                            b.atv > 32 ? '#10b981' : b.atv > 30 ? '#f59e0b' : '#ef4444'
                        ),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            color: '#1f2937',
                            font: { weight: 'bold' },
                            anchor: 'end',
                            align: 'top',
                            formatter: value => 'AED ' + value.toFixed(1)
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: { 
                            beginAtZero: true,
                            display: false
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Market Share Chart
        function createMarketShareChart() {
            const ctx = document.getElementById('marketShareChart').getContext('2d');
            charts.marketShare = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: salesData.branches.map(b => b.name),
                    datasets: [{
                        data: salesData.branches.map(b => b.sales),
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6',
                            '#ef4444', '#06b6d4', '#f97316', '#a855f7', '#64748b'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: context => {
                                    const value = context.raw;
                                    const percentage = ((value / salesData.totalSales) * 100).toFixed(1);
                                    return `${context.label}: ${percentage}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Channel ATV Chart
        function createChannelATVChart() {
            const ctx = document.getElementById('channelATVChart').getContext('2d');
            const topATV = [...salesData.channels]
                .sort((a, b) => b.atv - a.atv)
                .slice(0, 6);
            
            charts.channelATV = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topATV.map(c => c.name.substring(0, 15)),
                    datasets: [{
                        label: 'ATV',
                        data: topATV.map(c => c.atv),
                        backgroundColor: topATV.map(c => 
                            c.atv > 50 ? '#10b981' : c.atv > 40 ? '#f59e0b' : '#3b82f6'
                        ),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            color: '#1f2937',
                            font: { weight: 'bold' },
                            anchor: 'end',
                            align: 'top',
                            formatter: value => 'AED ' + value.toFixed(0)
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: { 
                            beginAtZero: true,
                            ticks: {
                                callback: value => 'AED ' + value.toFixed(0)
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Channel Mix Chart
        function createChannelMixChart() {
            const ctx = document.getElementById('channelMixChart').getContext('2d');
            charts.channelMix = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Sales', 'ATV', 'Growth', 'Margin', 'Transactions'],
                    datasets: [
                        {
                            label: 'Aggregator',
                            data: [95, 65, 85, 60, 90],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'In-Store',
                            data: [80, 40, 60, 85, 95],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderWidth: 2
                        },
                        {
                            label: 'Online',
                            data: [15, 100, 95, 90, 20],
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.2)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: { display: false },
                            pointLabels: {
                                font: {
                                    size: 11,
                                    weight: '600'
                                }
                            }
                        }
                    }
                }
            });
        }

        // Target Chart
        function createTargetChart() {
            const ctx = document.getElementById('targetChart').getContext('2d');
            charts.target = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Online Sales', 'Direct Delivery', 'Aggregator Mix', 'Overall ATV'],
                    datasets: [
                        {
                            label: 'Current',
                            data: [0.7, 3.4, 58.8, 30.39],
                            backgroundColor: '#3b82f6',
                            borderRadius: 6
                        },
                        {
                            label: 'Target',
                            data: [5.0, 8.0, 45.0, 35.0],
                            backgroundColor: '#10b981',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false } },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: value => value < 10 ? value + '%' : value < 20 ? value + '%' : 'AED ' + value
                            }
                        }
                    }
                }
            });
        }

        // Weekly Pattern Chart
        function createWeeklyPatternChart() {
            const ctx = document.getElementById('weeklyPatternChart').getContext('2d');
            
            // Calculate average sales by day of week
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const weeklyAverages = Array(7).fill(0);
            const counts = Array(7).fill(0);
            
            salesData.dailyData.forEach(day => {
                const dayIndex = days.indexOf(day.day);
                weeklyAverages[dayIndex] += day.sales;
                counts[dayIndex] += 1;
            });
            
            const data = weeklyAverages.map((sum, i) => sum / counts[i]);
            
            charts.weeklyPattern = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Avg Daily Sales',
                        data: data,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: context => `AED ${(context.raw/1000).toFixed(0)}K`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: value => 'AED ' + (value/1000).toFixed(0) + 'K'
                            }
                        }
                    }
                }
            });
        }

        // Update dashboard based on filters
        function updateDashboard() {
            showLoading();
            
            setTimeout(() => {
                const branchFilter = document.getElementById('branchFilter').value;
                const channelFilter = document.getElementById('channelFilter').value;
                const timeFilter = document.getElementById('timeFilter').value;
                
                // Update insight based on filters
                let insight = "";
                if (branchFilter !== 'all') {
                    const branch = salesData.branches.find(b => b.name === branchFilter);
                    if (branch) {
                        insight += `Focusing on ${branchFilter}: Contributes ${((branch.sales/salesData.totalSales)*100).toFixed(1)}% of total sales with ATV of AED ${branch.atv}. `;
                    }
                }
                
                if (channelFilter !== 'all') {
                    const channel = salesData.channels.find(c => c.name === channelFilter);
                    if (channel) {
                        insight += `${channelFilter} contributes ${((channel.sales/salesData.totalSales)*100).toFixed(1)}% of sales. `;
                    }
                }
                
                // Update charts with filtered data
                updateChartsWithFilters();
                
                hideLoading();
                showToast('Dashboard updated successfully!');
            }, 500);
        }

        function updateChartsWithFilters() {
            // In a real application, this would fetch new data based on filters
            // For now, we'll just update the existing charts
            if (charts.dailyTrend) {
                charts.dailyTrend.update();
            }
        }

        // Toggle export menu
        function toggleExportMenu() {
            const dropdown = document.getElementById('exportDropdown');
            dropdown.classList.toggle('show');
        }

        // Close export menu when clicking outside
        document.addEventListener('click', (event) => {
            const dropdown = document.getElementById('exportDropdown');
            const button = document.querySelector('.export-menu button');
            
            if (!dropdown.contains(event.target) && !button.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Export as PDF
        async function exportPDF() {
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4');
                const element = document.querySelector('.container');
                
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 280;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                doc.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                doc.save('Sales_Dashboard_January_2026.pdf');
                
                showToast('PDF exported successfully!');
            } catch (error) {
                console.error('Error exporting PDF:', error);
                showToast('Error exporting PDF', 'error');
            } finally {
                hideLoading();
            }
        }

        // Export as Excel (simulated)
        function exportExcel() {
            showLoading();
            
            setTimeout(() => {
                // In a real application, this would generate an Excel file
                // For now, we'll create a CSV download
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Branch,Sales,Transactions,ATV,Growth\n";
                
                salesData.branches.forEach(branch => {
                    csvContent += `${branch.name},${branch.sales},${branch.transactions},${branch.atv},${branch.growth}\n`;
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "sales_data_january_2026.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                hideLoading();
                showToast('Excel data exported successfully!');
            }, 1000);
        }

        // Print dashboard
        function printDashboard() {
            window.print();
        }

        // Download detailed data
        function downloadDetailedData() {
            showLoading();
            
            setTimeout(() => {
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Date,Branch,Channel,Sales,Transactions,ATV,Day of Week\n";
                
                salesData.dailyData.forEach(day => {
                    csvContent += `${day.date},${day.branch},${day.channel},${day.sales},${day.transactions},${day.atv},${day.day}\n`;
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "detailed_sales_data.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                hideLoading();
                showToast('Detailed data downloaded!');
            }, 500);
        }

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Update charts for the selected tab
            setTimeout(() => {
                Object.values(charts).forEach(chart => {
                    if (chart) chart.resize();
                });
            }, 100);
        }

        // Toggle view mode
        function toggleViewMode() {
            const mode = document.getElementById('viewMode').value;
            showToast(`Switched to ${mode} view`);
        }

        // Toggle chart view
        function toggleChartView(chartId) {
            const chart = charts[chartId];
            if (chart.config.type === 'bar') {
                chart.config.type = 'line';
            } else {
                chart.config.type = 'bar';
            }
            chart.update();
        }

        // Update trend chart
        function updateTrendChart() {
            const metric = document.getElementById('trendMetric').value;
            const chart = charts.dailyTrend;
            
            if (!chart) return;
            
            let data, label, yAxisCallback;
            
            switch(metric) {
                case 'sales':
                    data = salesData.dailyData.map(d => d.sales);
                    label = 'Sales (AED)';
                    yAxisCallback = value => 'AED ' + (value/1000).toFixed(0) + 'K';
                    break;
                case 'transactions':
                    data = salesData.dailyData.map(d => d.transactions);
                    label = 'Transactions';
                    yAxisCallback = value => value.toLocaleString();
                    break;
                case 'atv':
                    data = salesData.dailyData.map(d => d.atv);
                    label = 'ATV (AED)';
                    yAxisCallback = value => 'AED ' + value.toFixed(0);
                    break;
            }
            
            chart.data.datasets[0].data = data;
            chart.data.datasets[0].label = label;
            chart.options.scales.y.ticks.callback = yAxisCallback;
            chart.update();
            
            showToast(`Switched to ${metric} view`);
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('branchFilter').value = 'all';
            document.getElementById('channelFilter').value = 'all';
            document.getElementById('timeFilter').value = 'month';
            document.getElementById('viewMode').value = 'overview';
            
            updateDashboard();
            showToast('Filters reset to default');
        }

        // Show loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 300);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            messageEl.textContent = message;
            toast.style.display = 'flex';
            
            if (type === 'error') {
                toast.style.background = '#ef4444';
            } else if (type === 'warning') {
                toast.style.background = '#f59e0b';
            } else {
                toast.style.background = '#10b981';
            }
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
